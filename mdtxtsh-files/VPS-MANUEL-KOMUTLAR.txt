# ==========================================
# ğŸš¨ VPS'DE MANUEL OLARAK Ã‡ALIÅTIRIN
# ==========================================
# Her satÄ±rÄ± TEK TEK kopyalayÄ±p SSH'de Ã§alÄ±ÅŸtÄ±rÄ±n

# 1. Repo dizinine git
cd /root/neuroviabot/bot

# 2. Mevcut .env'i kontrol et
cat .env

# 3. SESSION_SECRET'Ä± sil (varsa eski/yanlÄ±ÅŸ deÄŸer)
sed -i '/SESSION_SECRET/d' .env

# 4. SESSION_SECRET ekle (DOÄRU DEÄER)
echo 'SESSION_SECRET=fdd863a42064ec909542df57b48d3f160d6f6ccc36ce8e31c303d480e1f03186' >> .env

# 5. .env'i tekrar kontrol et (SESSION_SECRET olmalÄ±)
cat .env | grep SESSION_SECRET

# 6. PM2'yi TAMAMEN DURUR (Ã¶nemli!)
pm2 kill

# 7. 2 saniye bekle
sleep 2

# 8. PM2 Ecosystem ile baÅŸlat
pm2 start PM2-ECOSYSTEM.config.js

# 9. PM2'yi kaydet
pm2 save

# 10. PM2 durumunu kontrol et (4 servis online olmalÄ±)
pm2 status

# 11. Webhook loglarÄ±nÄ± kontrol et
pm2 logs webhook-deploy --lines 20

# ==========================================
# ğŸ¯ BAÅARILI Ã‡IKTI ÅU ÅEKÄ°LDE OLMALI:
# ==========================================
# [START] ğŸ¯ Webhook server listening on port 9000
# [START] ğŸ” Webhook secret configured
# [START] ğŸ“ Repository path: /root/neuroviabot/bot
# [START] âœ… Ready to receive webhooks!

# ==========================================
# âš ï¸ HALA SESSION_SECRET HATASI ALIYORSANIZ:
# ==========================================

# .env dosyasÄ±nÄ±n varlÄ±ÄŸÄ±nÄ± kesin olarak kontrol et
ls -la /root/neuroviabot/bot/.env

# .env dosyasÄ±nÄ± doÄŸrudan dÃ¼zenle
nano /root/neuroviabot/bot/.env

# AÅŸaÄŸÄ±daki satÄ±rÄ± ekleyin (baÅŸka bir SESSION_SECRET satÄ±rÄ± varsa silin):
# SESSION_SECRET=fdd863a42064ec909542df57b48d3f160d6f6ccc36ce8e31c303d480e1f03186

# Kaydet: Ctrl+O, Enter, Ctrl+X

# PM2'yi tekrar kill + start yapÄ±n
pm2 kill
pm2 start PM2-ECOSYSTEM.config.js
pm2 save

# ==========================================
# ğŸ› MODULE_NOT_FOUND HATASI Ä°Ã‡Ä°N:
# ==========================================

# Bot dizininde npm install
cd /root/neuroviabot/bot
npm install

# Backend'de npm install
cd /root/neuroviabot/bot/neuroviabot-backend
npm install

# Frontend'de npm install ve build
cd /root/neuroviabot/bot/neuroviabot-frontend
npm install
npm run build

# Ana dizine dÃ¶n
cd /root/neuroviabot/bot

# PM2'yi yeniden baÅŸlat
pm2 restart all

